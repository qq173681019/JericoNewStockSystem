<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Error Handling Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .result { margin-top: 10px; padding: 10px; background: #f0f0f0; }
    </style>
</head>
<body>
    <h1>Error Handling Test</h1>
    
    <div class="test-section">
        <h2>Test 1: Timeout Test</h2>
        <p>This will test if timeout error shows alert</p>
        <button onclick="testTimeout()">Test Timeout (should fail in 2 seconds)</button>
        <div class="result" id="result1"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 2: Network Error Test</h2>
        <p>This will test if network error shows alert</p>
        <button onclick="testNetworkError()">Test Network Error</button>
        <div class="result" id="result2"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 3: Success Test</h2>
        <p>This will test if successful request works</p>
        <button onclick="testSuccess()">Test Success</button>
        <div class="result" id="result3"></div>
    </div>

    <script>
        const FETCH_TIMEOUT = 2000; // 2 seconds for testing

        async function fetchWithTimeout(url, options = {}, timeout = FETCH_TIMEOUT) {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), timeout);
            
            try {
                const response = await fetch(url, {
                    ...options,
                    signal: controller.signal
                });
                clearTimeout(timeoutId);
                return response;
            } catch (error) {
                clearTimeout(timeoutId);
                if (error.name === 'AbortError') {
                    throw new Error('请求超时，请检查网络连接或稍后重试');
                }
                throw error;
            }
        }

        async function testTimeout() {
            const result = document.getElementById('result1');
            result.textContent = 'Testing...';
            
            try {
                // This URL should timeout
                const response = await fetchWithTimeout('https://httpstat.us/200?sleep=5000', {}, 2000);
                result.textContent = '✗ Should have timed out but did not';
                result.style.color = 'red';
            } catch (error) {
                alert(`❌ Timeout Error\n\n${error.message}`);
                result.textContent = `✓ Correctly showed alert: ${error.message}`;
                result.style.color = 'green';
            }
        }

        async function testNetworkError() {
            const result = document.getElementById('result2');
            result.textContent = 'Testing...';
            
            try {
                // This URL should cause network error
                const response = await fetchWithTimeout('http://invalid-domain-that-does-not-exist-12345.com');
                result.textContent = '✗ Should have errored but did not';
                result.style.color = 'red';
            } catch (error) {
                alert(`❌ Network Error\n\n${error.message}`);
                result.textContent = `✓ Correctly showed alert: ${error.message}`;
                result.style.color = 'green';
            }
        }

        async function testSuccess() {
            const result = document.getElementById('result3');
            result.textContent = 'Testing...';
            
            try {
                // This URL should succeed
                const response = await fetchWithTimeout('https://httpstat.us/200', {}, 5000);
                if (response.ok) {
                    alert('✅ Success\n\nRequest completed successfully');
                    result.textContent = '✓ Request succeeded';
                    result.style.color = 'green';
                } else {
                    throw new Error('Response not OK');
                }
            } catch (error) {
                result.textContent = `✗ Error: ${error.message}`;
                result.style.color = 'red';
            }
        }
    </script>
</body>
</html>
